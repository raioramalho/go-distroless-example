# Dockerfile para desenvolvimento com hot-reload
# Usa Air para recarregar automaticamente em mudanças

FROM golang:1.21-alpine

# Instalar ferramentas de desenvolvimento
RUN apk add --no-cache \
    git \
    make \
    curl \
    bash

# Instalar Air (hot-reload) - baixar binário
RUN curl -sSfL https://raw.githubusercontent.com/cosmtrek/air/master/install.sh | sh -s -- -b $(go env GOPATH)/bin

# Criar diretório de trabalho
WORKDIR /app

# Copiar go.mod
COPY go.mod ./

# Copiar código fonte primeiro para go mod tidy funcionar
COPY src/ ./src/

# Baixar dependências e gerar go.sum
RUN go mod tidy && go mod download

# Copiar configuração do Air
COPY .air.toml ./

# Copiar .env se existir
COPY .env* ./

# Criar diretório tmp para Air
RUN mkdir -p tmp

# Expor porta
EXPOSE 8080

# Comando padrão: usar Air para hot-reload
CMD ["air", "-c", ".air.toml"]

