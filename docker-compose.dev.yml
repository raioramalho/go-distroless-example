services:
  app-dev:
    build:
      context: .
      dockerfile: build/Dockerfile.dev
    container_name: go-distroless-dev
    ports:
      - "${PORT:-8080}:${PORT:-8080}"
    volumes:
      # Montar c칩digo fonte para hot-reload
      - ./src:/app/src:cached
      - ./go.mod:/app/go.mod:cached
      - ./go.sum:/app/go.sum:cached
      - ./.air.toml:/app/.air.toml:cached
      - ./.env:/app/.env:cached
      # Cache de m칩dulos Go (performance)
      - go-modules:/go/pkg/mod
      # Diret칩rio tempor치rio do Air
      - ./tmp:/app/tmp:cached
    env_file:
      - .env
    environment:
      - PORT=${PORT:-8080}
      - GO_ENV=${GO_ENV:-development}
      - LOG_LEVEL=${LOG_LEVEL:-debug}
    networks:
      - dev-network
    restart: unless-stopped
    # Healthcheck
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  go-modules:
    driver: local

networks:
  dev-network:
    driver: bridge

